<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEGO Press & Case Study Viewer | BCG × LEGO Case Study</title>
    <meta name="description" content="Embedded PDF viewer for MIT, Harvard Business Review, and BCG interview materials referenced in the LEGO case study.">
    <link rel="stylesheet" href="/style.css?v=20260225-2">
    <style>
        .pdf-page {
            min-height: 100vh;
            padding: 40px 0 64px;
        }

        .pdf-shell {
            background: rgba(7, 15, 35, 0.82);
            border: 1px solid rgba(68, 122, 203, 0.28);
            border-radius: 18px;
            padding: 20px;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.03);
        }

        .pdf-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .pdf-header h1 {
            font-size: clamp(24px, 3vw, 34px);
            margin: 0;
        }

        .pdf-header p {
            margin: 6px 0 0;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .pdf-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 14px;
            padding: 12px;
            border-radius: 12px;
            background: rgba(10, 18, 40, 0.85);
            border: 1px solid rgba(68, 122, 203, 0.18);
        }

        .pdf-toolbar-group {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .pdf-toolbar button {
            appearance: none;
            border: 1px solid rgba(68, 122, 203, 0.3);
            background: rgba(68, 122, 203, 0.08);
            color: var(--text-primary);
            border-radius: 10px;
            padding: 8px 12px;
            font: inherit;
            cursor: pointer;
        }

        .pdf-toolbar button:hover {
            background: rgba(68, 122, 203, 0.14);
            border-color: rgba(68, 122, 203, 0.45);
        }

        .pdf-toolbar button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pdf-status {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .pdf-canvas-wrap {
            border-radius: 12px;
            border: 1px solid rgba(68, 122, 203, 0.2);
            background: rgba(0, 0, 0, 0.25);
            padding: 14px;
            min-height: 320px;
        }

        .pdf-pages {
            display: grid;
            gap: 16px;
        }

        .pdf-page-canvas {
            width: 100%;
            height: auto;
            display: block;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 8px 22px rgba(0, 0, 0, 0.28);
        }

        .pdf-page-card {
            display: grid;
            gap: 8px;
            justify-items: center;
        }

        .pdf-page-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .pdf-loading,
        .pdf-error {
            padding: 16px;
            border-radius: 12px;
            border: 1px solid rgba(68, 122, 203, 0.18);
            background: rgba(10, 18, 40, 0.7);
            color: var(--text-secondary);
            font-size: 14px;
        }

        .pdf-error {
            border-color: rgba(239, 68, 68, 0.35);
            color: #fecaca;
            background: rgba(127, 29, 29, 0.18);
        }

        .pdf-fallback {
            margin-top: 14px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .pdf-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .pdf-page {
                padding: 24px 0 40px;
            }

            .pdf-shell {
                padding: 16px;
                border-radius: 14px;
            }

            .pdf-toolbar {
                padding: 10px;
            }

            .pdf-canvas-wrap {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>

    <header>
        <nav class="container">
            <div class="logo">
                <a href="/" style="display: flex; align-items: center; gap: 12px; text-decoration: none; color: inherit;">
                    <img src="https://raw.githubusercontent.com/jimmarkunas/portfolio/2722bf9b52e9c947fff242eb252bfe38a2b63cc2/images/logo/ujcg-logo-blue.png" alt="UJCG" style="width:32px;height:32px;object-fit:contain;">
                    JIM MARKUNAS
                </a>
            </div>
            <ul class="nav-links">
                <li><a href="/work/lego/" id="pdfBackNavLink">Back to Case Study</a></li>
                <li><a href="/contact/">Contact</a></li>
            </ul>
            <button class="hamburger" id="hamburger" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </nav>
    </header>

    <div class="mobile-menu" id="mobileMenu">
        <a href="/work/lego/" id="pdfBackMobileLink">Back to Case Study</a>
        <a href="/contact/">Contact</a>
    </div>

    <main class="pdf-page">
        <div class="container">
            <section class="pdf-shell">
                <div class="pdf-header">
                    <div>
                        <h1 id="pdfPageTitle">LEGO Press & Case Studies</h1>
                        <p id="pdfPageSubtitle">Embedded document proof for the BCG × LEGO case study.</p>
                    </div>
                    <div class="pdf-actions">
                        <a class="btn btn-secondary" id="pdfBackPrimaryLink" href="/work/lego/">Back to Case Study</a>
                        <a class="btn btn-primary" id="pdfOpenLink" href="#" target="_blank" rel="noopener">Open PDF in New Tab</a>
                    </div>
                </div>

                <div class="pdf-toolbar" aria-label="PDF viewer controls">
                    <div class="pdf-toolbar-group">
                        <button type="button" id="pdfZoomOut">Zoom Out</button>
                        <button type="button" id="pdfZoomIn">Zoom In</button>
                        <button type="button" id="pdfFitWidth">Fit Width</button>
                        <button type="button" id="pdfRerender">Re-render</button>
                    </div>
                    <div class="pdf-status" id="pdfStatus">Loading PDF viewer...</div>
                </div>

                <div class="pdf-canvas-wrap">
                    <div class="pdf-loading" id="pdfLoading">Loading document PDF...</div>
                    <div class="pdf-error" id="pdfError" hidden>
                        Could not render the PDF in this viewer. Use
                        <a id="pdfErrorLink" href="#" target="_blank" rel="noopener">Open PDF in New Tab</a>.
                    </div>
                    <div class="pdf-pages" id="pdfPages" hidden></div>
                </div>

                <p class="pdf-fallback">
                    If the PDF does not render in your browser or VS Code preview, use
                    <a id="pdfFallbackLink" href="#" target="_blank" rel="noopener">Open PDF in New Tab</a>.
                </p>
            </section>
        </div>
    </main>

    <script src="/script.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        (function () {
            var docs = {
                "harvard": {
                    title: "Harvard Business Review — LEGO Digital Transformation",
                    subtitle: "HBR coverage of LEGO's digital transformation and operating model.",
                    file: "/work/lego/files/01%20Harvard%20Business%20Review.pdf"
                },
                "mit": {
                    title: "MIT Case Study — LEGO Transformation",
                    subtitle: "MIT teaching case material on LEGO's enterprise and digital transformation.",
                    file: "/work/lego/files/02%20MIT%20Case%20Study.pdf"
                },
                "bcg": {
                    title: "BCG Interview — LEGO CEO (Knudstorp)",
                    subtitle: "BCG interview with LEGO CEO Jorgen Vig Knudstorp on growth, culture, and operating discipline.",
                    file: "/work/lego/files/05%20BCG%20Interview%20Lego%20CEO.pdf"
                },
                "guardian": {
                    title: "The Guardian — LEGO Digital",
                    subtitle: "The Guardian coverage highlighting LEGO's digital evolution and broader transformation story.",
                    file: "/work/lego/files/03%20The%20Guardian%20LEGO%20Digital.pdf"
                },
                "misq": {
                    title: "MIS Quarterly Executive — LEGO Transformation",
                    subtitle: "MIS Quarterly Executive analysis of LEGO's transformation, governance, and digital execution.",
                    file: "/work/lego/files/04%20MIS%20Quarterly%20Executive_compressed.pdf"
                }
            };
            var params = new URLSearchParams(window.location.search);
            var docKey = params.get("doc") || "harvard";
            var from = params.get("from") || "case";
            var selected = docs[docKey] || docs["harvard"];
            var pdfUrl = selected.file;
            var pagesEl = document.getElementById("pdfPages");
            var loadingEl = document.getElementById("pdfLoading");
            var errorEl = document.getElementById("pdfError");
            var statusEl = document.getElementById("pdfStatus");
            var titleEl = document.getElementById("pdfPageTitle");
            var subtitleEl = document.getElementById("pdfPageSubtitle");
            var backNavLinkEl = document.getElementById("pdfBackNavLink");
            var backMobileLinkEl = document.getElementById("pdfBackMobileLink");
            var backPrimaryLinkEl = document.getElementById("pdfBackPrimaryLink");
            var openLinkEl = document.getElementById("pdfOpenLink");
            var errorLinkEl = document.getElementById("pdfErrorLink");
            var fallbackLinkEl = document.getElementById("pdfFallbackLink");
            var zoomInBtn = document.getElementById("pdfZoomIn");
            var zoomOutBtn = document.getElementById("pdfZoomOut");
            var fitWidthBtn = document.getElementById("pdfFitWidth");
            var rerenderBtn = document.getElementById("pdfRerender");

            var baseScale = 1;
            var userZoom = 1;
            var renderToken = 0;
            var pdfDoc = null;
            var lastContainerWidth = 0;

            titleEl.textContent = selected.title;
            subtitleEl.textContent = selected.subtitle;
            document.title = selected.title + " | BCG × LEGO Case Study";
            var backHref = from === "home" ? "/#press" : "/work/lego/#proof";
            var backLabel = from === "home" ? "Back to Homepage" : "Back to Case Study";
            [backNavLinkEl, backMobileLinkEl, backPrimaryLinkEl].forEach(function (el) {
                if (!el) return;
                el.href = backHref;
                el.textContent = backLabel;
            });
            openLinkEl.href = pdfUrl;
            errorLinkEl.href = pdfUrl;
            fallbackLinkEl.href = pdfUrl;

            function setStatus(text) {
                statusEl.textContent = text;
            }

            function showError(message) {
                if (message) {
                    errorEl.firstChild.textContent = message + " ";
                }
                errorEl.hidden = false;
                loadingEl.hidden = true;
                pagesEl.hidden = true;
                setStatus("PDF viewer unavailable");
                zoomInBtn.disabled = true;
                zoomOutBtn.disabled = true;
                fitWidthBtn.disabled = true;
                rerenderBtn.disabled = false;
            }

            function clearPages() {
                pagesEl.innerHTML = "";
            }

            function clampZoom(nextZoom) {
                return Math.min(2.25, Math.max(0.7, nextZoom));
            }

            async function renderAllPages() {
                if (!pdfDoc) return;

                var token = ++renderToken;
                loadingEl.hidden = false;
                errorEl.hidden = true;
                pagesEl.hidden = true;
                clearPages();
                zoomInBtn.disabled = true;
                zoomOutBtn.disabled = true;
                fitWidthBtn.disabled = true;
                rerenderBtn.disabled = true;

                try {
                    var firstPage = await pdfDoc.getPage(1);
                    if (token !== renderToken) return;

                    var unscaled = firstPage.getViewport({ scale: 1 });
                    var containerWidth = pagesEl.clientWidth || pagesEl.parentElement.clientWidth || 900;
                    lastContainerWidth = containerWidth;
                    baseScale = Math.max(0.5, (containerWidth - 24) / unscaled.width);
                    var finalScale = baseScale * userZoom;

                    setStatus("Rendering " + pdfDoc.numPages + " page" + (pdfDoc.numPages === 1 ? "" : "s") + " at " + Math.round(finalScale * 100) + "%...");

                    for (var pageNumber = 1; pageNumber <= pdfDoc.numPages; pageNumber += 1) {
                        var page = pageNumber === 1 ? firstPage : await pdfDoc.getPage(pageNumber);
                        if (token !== renderToken) return;

                        var viewport = page.getViewport({ scale: finalScale });
                        var canvas = document.createElement("canvas");
                        canvas.className = "pdf-page-canvas";
                        canvas.width = Math.floor(viewport.width);
                        canvas.height = Math.floor(viewport.height);

                        var wrapper = document.createElement("div");
                        wrapper.className = "pdf-page-card";

                        var label = document.createElement("div");
                        label.className = "pdf-page-label";
                        label.textContent = "Page " + pageNumber + " of " + pdfDoc.numPages;

                        wrapper.appendChild(canvas);
                        wrapper.appendChild(label);
                        pagesEl.appendChild(wrapper);

                        await page.render({
                            canvasContext: canvas.getContext("2d", { alpha: false }),
                            viewport: viewport
                        }).promise;
                    }

                    if (token !== renderToken) return;

                    loadingEl.hidden = true;
                    pagesEl.hidden = false;
                    setStatus(pdfDoc.numPages + " page" + (pdfDoc.numPages === 1 ? "" : "s") + " rendered · " + Math.round(finalScale * 100) + "%");
                    zoomInBtn.disabled = false;
                    zoomOutBtn.disabled = false;
                    fitWidthBtn.disabled = false;
                    rerenderBtn.disabled = false;
                } catch (err) {
                    console.error(err);
                    showError("Could not render the PDF.");
                }
            }

            async function loadPdf() {
                if (!window.pdfjsLib) {
                    showError("PDF.js failed to load.");
                    return;
                }

                try {
                    window.pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
                    setStatus("Loading PDF...");
                    pdfDoc = await window.pdfjsLib.getDocument(pdfUrl).promise;
                    zoomInBtn.disabled = false;
                    zoomOutBtn.disabled = false;
                    fitWidthBtn.disabled = false;
                    rerenderBtn.disabled = false;
                    await renderAllPages();
                } catch (err) {
                    console.error(err);
                    showError("Could not load the PDF.");
                }
            }

            zoomInBtn.addEventListener("click", function () {
                userZoom = clampZoom(userZoom + 0.15);
                renderAllPages();
            });

            zoomOutBtn.addEventListener("click", function () {
                userZoom = clampZoom(userZoom - 0.15);
                renderAllPages();
            });

            fitWidthBtn.addEventListener("click", function () {
                userZoom = 1;
                renderAllPages();
            });

            rerenderBtn.addEventListener("click", function () {
                renderAllPages();
            });

            var resizeTimer = null;
            window.addEventListener("resize", function () {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function () {
                    var currentWidth = pagesEl.clientWidth || pagesEl.parentElement.clientWidth || 0;
                    if (!currentWidth || Math.abs(currentWidth - lastContainerWidth) < 40) return;
                    renderAllPages();
                }, 180);
            });

            loadPdf();
        })();
    </script>
</body>
</html>
